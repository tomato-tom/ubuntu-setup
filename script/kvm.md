# KVM QEMU libvirt インストール

長々とでるインストールの出力、一部省略して

`qemu-kvm`パッケージグループのインストール
```
▪ sudo apt install qemu-kvm
[sudo] password for mininoble:
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
Note, selecting 'qemu-system-x86' instead of 'qemu-kvm'
The following additional packages will be installed:
  ipxe-qemu ipxe-qemu-256k-compat-efi-roms libcacard0 libfdt1 libiscsi7 libjack-jackd2-0
  libsdl2-2.0-0 liburing2 libvirglrenderer1 ovmf qemu-block-extra qemu-system-common
  qemu-system-data qemu-system-gui qemu-system-modules-opengl qemu-system-modules-spice
  qemu-utils seabios
Suggested packages:
  jackd2 samba vde2
The following NEW packages will be installed:
  ipxe-qemu ipxe-qemu-256k-compat-efi-roms libcacard0 libfdt1 libiscsi7 libjack-jackd2-0
  libsdl2-2.0-0 liburing2 libvirglrenderer1 ovmf qemu-block-extra qemu-system-common
  qemu-system-data qemu-system-gui qemu-system-modules-opengl qemu-system-modules-spice qemu-system-x86 qemu-utils seabios 0 upgraded, 19 newly installed, 0 to remove and 10 not upgraded.  Need to get 25.4 MB of archives.  After this operation, 115 MB of additional disk space will be used.  Do you want to continue? [Y/n] y ...  Unpacking ovmf (2024.02-2) ...  Setting up libfdt1:amd64 (1.7.0-2build1) ...  Setting up libcacard0:amd64 (1:2.8.0-3build4) ...  Setting up ovmf (2024.02-2) ...  Setting up libvirglrenderer1:amd64 (1.0.0-1ubuntu2) ...  Setting up qemu-system-data (1:8.2.2+ds-0ubuntu1.4) ...
Setting up seabios (1.16.3-2) ...
Setting up libjack-jackd2-0:amd64 (1.9.21~dfsg-3ubuntu3) ...
Setting up ipxe-qemu (1.21.1+git-20220113.fbbdc3926-0ubuntu2) ...
Setting up ipxe-qemu-256k-compat-efi-roms (1.0.0+git-20150424.a25a16d-0ubuntu5) ...
Setting up liburing2:amd64 (2.5-1build1) ...
Setting up libiscsi7:amd64 (1.19.0-3build4) ...
Setting up libsdl2-2.0-0:amd64 (2.30.0+dfsg-1build3) ...
Setting up qemu-system-common (1:8.2.2+ds-0ubuntu1.4) ...
Created symlink /etc/systemd/system/multi-user.target.wants/qemu-kvm.service → /usr/lib/sys
temd/system/qemu-kvm.service.
Setting up qemu-system-x86 (1:8.2.2+ds-0ubuntu1.4) ...
Setting up qemu-utils (1:8.2.2+ds-0ubuntu1.4) ...
Setting up qemu-block-extra (1:8.2.2+ds-0ubuntu1.4) ...
Created symlink /etc/systemd/system/multi-user.target.wants/run-qemu.mount → /usr/lib/syste
md/system/run-qemu.mount.
Setting up qemu-system-modules-opengl (1:8.2.2+ds-0ubuntu1.4) ...
Setting up qemu-system-gui (1:8.2.2+ds-0ubuntu1.4) ...
Setting up qemu-system-modules-spice (1:8.2.2+ds-0ubuntu1.4) ...
Processing triggers for hicolor-icon-theme (0.17-2) ...
Processing triggers for gnome-menus (3.36.0-1.1ubuntu3) ...
Processing triggers for libc-bin (2.39-0ubuntu8.3) ...
Processing triggers for man-db (2.12.0-4build2) ...
Processing triggers for desktop-file-utils (0.27-2build1) ...
```

libvirt関連のインストール
```
▪ ./kvm_qemu_libvirt.sh
[sudo] password for mininoble:
Reading package lists... Done
Building dependency tree... Done
Reading state information... Done
Note, selecting 'qemu-system-x86' instead of 'qemu-kvm'
qemu-system-x86 is already the newest version (1:8.2.2+ds-0ubuntu1.4).
The following additional packages will be installed:
  dmeventd gir1.2-libosinfo-1.0 libburn4t64 libdevmapper-event1.02.1 libgtk-vnc-2.0-0
  libgvnc-1.0-0 libisoburn1t64 libisofs6t64 liblvm2cmd2.03 libnss-mymachines
  libosinfo-1.0-0 libosinfo-l10n libphodav-3.0-0 libphodav-3.0-common
  libspice-client-glib-2.0-8 libspice-client-gtk-3.0-5 libtpms0 libusbredirhost1t64
  libvirt-daemon libvirt-daemon-config-network libvirt-daemon-config-nwfilter
  libvirt-daemon-driver-qemu libvirt-daemon-system-systemd libvirt-glib-1.0-0
  libvirt-glib-1.0-data libvirt-l10n libvirt0 libxml2-utils libyajl2 lvm2 mdevctl
  osinfo-db python3-libvirt python3-libxml2 spice-client-glib-usb-acl-helper swtpm
  swtpm-tools systemd-container thin-provisioning-tools virt-viewer xorriso
Suggested packages:
  ifupdown gstreamer1.0-plugins-bad libvirt-clients-qemu libvirt-login-shell
  libvirt-daemon-driver-storage-gluster libvirt-daemon-driver-storage-iscsi-direct
  libvirt-daemon-driver-storage-rbd libvirt-daemon-driver-storage-zfs
  libvirt-daemon-driver-lxc libvirt-daemon-driver-vbox libvirt-daemon-driver-xen numad
  passt auditd nfs-common open-iscsi pm-utils systemtap trousers python3-argcomplete
  xorriso-tcltk jigit cdck
The following NEW packages will be installed:
  bridge-utils dmeventd gir1.2-libosinfo-1.0 libburn4t64 libdevmapper-event1.02.1
  libgtk-vnc-2.0-0 libgvnc-1.0-0 libisoburn1t64 libisofs6t64 liblvm2cmd2.03
  libnss-mymachines libosinfo-1.0-0 libosinfo-bin libosinfo-l10n libphodav-3.0-0
  libphodav-3.0-common libspice-client-glib-2.0-8 libspice-client-gtk-3.0-5 libtpms0
  libusbredirhost1t64 libvirt-clients libvirt-daemon libvirt-daemon-config-network
  libvirt-daemon-config-nwfilter libvirt-daemon-driver-qemu libvirt-daemon-system
  libvirt-daemon-system-systemd libvirt-glib-1.0-0 libvirt-glib-1.0-data libvirt-l10n
  libvirt0 libxml2-utils libyajl2 lvm2 mdevctl osinfo-db python3-libvirt python3-libxml2
  spice-client-glib-usb-acl-helper swtpm swtpm-tools systemd-container
  thin-provisioning-tools virt-viewer virtinst xorriso
0 upgraded, 46 newly installed, 0 to remove and 10 not upgraded.
Need to get 11.7 MB of archives.
After this operation, 46.2 MB of additional disk space will be used.

...

Setting up libphodav-3.0-common (3.0-8build3) ...
Setting up libdevmapper-event1.02.1:amd64 (2:1.02.185-3ubuntu3.1) ...
Setting up spice-client-glib-usb-acl-helper (0.42-2ubuntu2) ...
Setting up libyajl2:amd64 (2.1.0-5build1) ...
Setting up libphodav-3.0-0:amd64 (3.0-8build3) ...
Setting up libusbredirhost1t64:amd64 (0.13.0-2.1build1) ...
Setting up python3-libxml2:amd64 (2.9.14+dfsg-1.3ubuntu3) ...
Setting up libgvnc-1.0-0:amd64 (1.3.1-1build2) ...
Setting up libvirt-glib-1.0-data (5.0.0-2build3) ...
Setting up thin-provisioning-tools (0.9.0-2ubuntu5.1) ...
Setting up osinfo-db (0.20240523-0ubuntu0.24.04.1) ...
Setting up bridge-utils (1.7.1-1ubuntu2) ...
Setting up libvirt0:amd64 (10.0.0-2ubuntu8.4) ...
Setting up systemd-container (255.4-1ubuntu8.4) ...
Created symlink /etc/systemd/system/multi-user.target.wants/machines.target → /usr/lib/syst
emd/system/machines.target.
Setting up libvirt-glib-1.0-0:amd64 (5.0.0-2build3) ...
Setting up libisofs6t64:amd64 (1.5.6.pl01-1.1ubuntu2) ...
Setting up libburn4t64:amd64 (1.5.6-1.1build1) ...
Setting up libtpms0:amd64 (0.9.3-0ubuntu4) ...
Setting up libisoburn1t64:amd64 (1:1.5.6-1.1ubuntu3) ...
Setting up libxml2-utils (2.9.14+dfsg-1.3ubuntu3) ...
Setting up libvirt-daemon-config-nwfilter (10.0.0-2ubuntu8.4) ...
Setting up xorriso (1:1.5.6-1.1ubuntu3) ...
Setting up libspice-client-glib-2.0-8:amd64 (0.42-2ubuntu2) ...
Setting up libosinfo-l10n (1.11.0-2build3) ...
Setting up libgtk-vnc-2.0-0:amd64 (1.3.1-1build2) ...
Setting up mdevctl (1.3.0-1ubuntu2) ...
Setting up libvirt-daemon-config-network (10.0.0-2ubuntu8.4) ...
Setting up python3-libvirt (10.0.0-1build1) ...
Setting up libvirt-clients (10.0.0-2ubuntu8.4) ...
Setting up libosinfo-1.0-0:amd64 (1.11.0-2build3) ...
Setting up libvirt-l10n (10.0.0-2ubuntu8.4) ...
Setting up libnss-mymachines:amd64 (255.4-1ubuntu8.4) ...
Setting up swtpm (0.7.3-0ubuntu5.24.04.1) ...
Setting up libvirt-daemon-driver-qemu (10.0.0-2ubuntu8.4) ...
Setting up libspice-client-gtk-3.0-5:amd64 (0.42-2ubuntu2) ...
Setting up libvirt-daemon-system-systemd (10.0.0-2ubuntu8.4) ...
Setting up virt-viewer (11.0-3build2) ...
Setting up libvirt-daemon (10.0.0-2ubuntu8.4) ...
Setting up gir1.2-libosinfo-1.0:amd64 (1.11.0-2build3) ...
Setting up virtinst (1:4.1.0-3ubuntu0.1) ...
Setting up libosinfo-bin (1.11.0-2build3) ...
Setting up swtpm-tools (0.7.3-0ubuntu5.24.04.1) ...
info: Selecting GID from range 100 to 999 ...
info: Adding group `swtpm' (GID 125) ...
info: The home dir /var/lib/swtpm you specified can't be accessed: No such file or director
y

info: Selecting UID from range 100 to 999 ...

info: Adding system user `swtpm' (UID 123) ...
info: Adding new user `swtpm' (UID 123) with group `swtpm' ...
info: Not creating home directory `/var/lib/swtpm'.
Setting up libvirt-daemon-system (10.0.0-2ubuntu8.4) ...
useradd warning: libvirt-qemu's uid 64055 is greater than SYS_UID_MAX 999
Enabling libvirt default network
Created symlink /etc/systemd/system/multi-user.target.wants/libvirtd.service → /usr/lib/sys
temd/system/libvirtd.service.
Created symlink /etc/systemd/system/sockets.target.wants/virtlockd.socket → /usr/lib/system
d/system/virtlockd.socket.
Created symlink /etc/systemd/system/sockets.target.wants/virtlogd.socket → /usr/lib/systemd
/system/virtlogd.socket.
Created symlink /etc/systemd/system/sockets.target.wants/libvirtd.socket → /usr/lib/systemd
/system/libvirtd.socket.
Created symlink /etc/systemd/system/sockets.target.wants/libvirtd-ro.socket → /usr/lib/syst
emd/system/libvirtd-ro.socket.
Created symlink /etc/systemd/system/sockets.target.wants/libvirtd-admin.socket → /usr/lib/s
ystemd/system/libvirtd-admin.socket.
Created symlink /etc/systemd/system/sockets.target.wants/virtlockd-admin.socket → /usr/lib/
systemd/system/virtlockd-admin.socket.
Created symlink /etc/systemd/system/sockets.target.wants/virtlogd-admin.socket → /usr/lib/s
ystemd/system/virtlogd-admin.socket.
Created symlink /etc/systemd/system/multi-user.target.wants/libvirt-guests.service → /usr/l
ib/systemd/system/libvirt-guests.service.
Created symlink /etc/systemd/system/multi-user.target.wants/virtlockd.service → /usr/lib/sy
stemd/system/virtlockd.service.
Created symlink /etc/systemd/system/multi-user.target.wants/virtlogd.service → /usr/lib/sys
temd/system/virtlogd.service.
Setting up libvirt-daemon dnsmasq configuration.
Setting up liblvm2cmd2.03:amd64 (2.03.16-3ubuntu3.1) ...
Setting up dmeventd (2:1.02.185-3ubuntu3.1) ...
Created symlink /etc/systemd/system/sockets.target.wants/dm-event.socket → /usr/lib/systemd
/system/dm-event.socket.
dm-event.service is a disabled or a static unit, not starting it.
Setting up lvm2 (2.03.16-3ubuntu3.1) ...
Created symlink /etc/systemd/system/sysinit.target.wants/blk-availability.service → /usr/li
b/systemd/system/blk-availability.service.
Created symlink /etc/systemd/system/sysinit.target.wants/lvm2-monitor.service → /usr/lib/sy
stemd/system/lvm2-monitor.service.
Created symlink /etc/systemd/system/sysinit.target.wants/lvm2-lvmpolld.socket → /usr/lib/sy
stemd/system/lvm2-lvmpolld.socket.
Processing triggers for dbus (1.14.10-4ubuntu4.1) ...
Processing triggers for shared-mime-info (2.4-4) ...
Processing triggers for install-info (7.1-3build2) ...
Processing triggers for desktop-file-utils (0.27-2build1) ...
Processing triggers for initramfs-tools (0.142ubuntu25.4) ...
update-initramfs: Generating /boot/initrd.img-6.8.0-49-generic
Processing triggers for hicolor-icon-theme (0.17-2) ...
Processing triggers for gnome-menus (3.36.0-1.1ubuntu3) ...
Processing triggers for libc-bin (2.39-0ubuntu8.3) ...
Processing triggers for man-db (2.12.0-4build2) ..
```

